#!/bin/bash

v=0
c="000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
b="000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
p="000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
while IFS="" read -r a || [ -n "$a" ]
do
    aa=$(echo ".$a.")
    n=""
    for i in $(seq 0 $((${#a}-1)))
    do
        n=$n$(echo ${aa:$i:3} | grep -o '@' | wc -l)
        if [[ $(( ${n:$i:1} + ${b:$i:1} + ${c:$i:1} )) -le 4 ]]
        then
            v=$(($v + ${p:$i:1}))
        fi
    done
    echo $n
    p=$(echo $a | sed "s/\./0/g" | sed "s/@/1/g")
    c=$(echo $b)
    b=$(echo $n)
done < $1
for i in $(seq 0 $((${#b}-1)))
do
    if [[ $(( ${b:$i:1} + ${c:$i:1} )) -le 4 ]]
    then
        v=$(($v + ${p:$i:1}))
    fi
done
echo $v

#1547
